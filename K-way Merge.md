## **K**-way Merge 설명

K-way Merge는 **K개**의 독립적으로 정렬된(sorted) 입력 스트림 또는
목록을 단일의 **정렬된 출력 스트림**으로 결합하는 알고리즘입니다. 분산
시스템, 특히 대규모 데이터 처리(예: MapReduce의 Reduce 단계, 분산
정렬)에서 최종 결과를 효율적으로 만들기 위해 필수적으로 사용됩니다.

### 1. 기본 원리

K-way Merge는 각 입력 스트림에서 **가장 작은(또는 가장 큰)** 원소를
효율적으로 찾아내어 출력 스트림으로 보내는 방식으로 동작합니다.

-   **입력:** K개의 이미 정렬된 목록(파일 또는 데이터 블록).

-   **출력:** 모든 입력 목록의 원소를 포함하며 전체가 정렬된 단일 목록.

### 2. 단계별 동작 방식

K-way Merge를 구현하는 가장 효율적인 방법은 **최소 힙(Min-Heap)** 또는
\*\*우선순위 큐(Priority Queue)\*\*를 사용하는 것입니다.

1.  **초기화:**

    -   **최소 힙**을 생성합니다.

    -   K개의 정렬된 입력 스트림 각각에서 **첫 번째 원소**를 가져와
        > (원소 값, 해당 스트림의 인덱스) 쌍으로 힙에 삽입합니다.

    -   힙의 크기는 K가 됩니다.

2.  **반복 병합:**

    -   힙이 빌 때까지 다음을 반복합니다.

        -   **가장 작은 원소 추출:** 힙의 루트에 있는 **가장 작은
            > 원소**를 추출합니다. 이것이 현재 전체에서 가장 작은
            > 원소이므로 출력 스트림에 기록합니다.

        -   **다음 원소 삽입:** 추출된 원소가 속했던 **입력 스트림**을
            > 확인합니다. 해당 스트림에서 **다음 원소**를 가져와 (값,
            > 스트림 인덱스) 쌍으로 힙에 삽입합니다.

        -   **힙 재정렬:** 새 원소의 삽입으로 인해 힙을 다시 정렬합니다
            > (힙파이 연산).

3.  **종료:** 모든 입력 스트림의 모든 원소가 처리되어 힙이 비면 병합이
    > 완료됩니다.

### 3. **\$K\$**-way Merge의 효율성

  -----------------------------------------------------------------------
  **요소**                **설명**                **효율성 근거**
  ----------------------- ----------------------- -----------------------
  **시간 복잡도**         N은 전체 원소의 총      각 원소는 한 번만 힙에
                          개수, K는 입력 스트림의 삽입되고 한 번만
                          개수일 때, 시간         추출됩니다. 힙에서
                          복잡도는 O(N \\log K)   삽입/추출/재정렬 연산의
                          입니다.                 비용은
                                                  \\mathcal{O}(\\log K)
                                                  이므로, 총 시간은 N번의
                                                  힙 연산, 즉
                                                  \\mathcal{O}(N \\log K)
                                                  이 됩니다.

  **K의 역할**            K가 커질수록 log K 값은 K가 N에 비해 매우 크지
                          증가하지만, K가 너무    않은 한, 이 방식은 가장
                          크지 않다면 (예: 수백   효율적인 병합
                          개 이하) 여전히 매우    방법입니다.
                          효율적입니다.           
  -----------------------------------------------------------------------

### 4. 응용 분야 (분산 정렬에서의 역할)

K-way Merge는 대규모 데이터 처리에서 다음과 같은 경우에 사용됩니다.

-   **Reduce 단계의 최종 병합:** MapReduce에서 각 Reducer는 수많은
    > Mapper로부터 중간 결과를 받습니다. 이 모든 중간 파일들을 키
    > 순서대로 그룹화하고 Reduce 함수에 전달하기 위해 **최종 K-way
    > Merge**가 사용됩니다. 여기서 K는 Reducer에게 데이터를 보낸
    > Mapper의 수 또는 Reducer가 디스크에 저장한 중간 파일의 수가 될 수
    > 있습니다.

-   **외부 정렬 (External Sorting):** 메모리에 한 번에 들어갈 수 없는
    > 대규모 파일을 정렬할 때, 파일을 작은 청크로 나누어 정렬한 후(Pass
    > 1), 이 정렬된 청크들을 **K-way Merge**를 사용하여 점진적으로
    > 하나의 큰 정렬된 파일로 병합합니다.
